<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
  <div th:replace="~{layout/base :: nav-bar}"></div>
  <main class="container">
    <h2>Community Posts</h2>

    <a th:href="@{/ui/post/create}" sec:authorize="isAuthenticated()" class="btn btn-primary">
      Create Post
    </a>

    <div th:each="post : ${posts}" class="card mt-1">
      <p class="post-meta text-muted">
        <strong th:text="${post.authorUsername}">username</strong>
        <span th:if="${post.authorRole}" th:text="| · ${post.authorRole}|"> · Role</span>
        <span th:if="${post.createdAt != null}" th:text="| · ${#temporals.format(post.createdAt, 'dd MMM yyyy')}|"> · Date</span>
      </p>
      <h4 th:text="${post.title}">Post Title</h4>
      <p th:text="${post.content}">Post content...</p>
      <p class="text-muted">Average Rating: <span th:text="${post.averageRating}">0</span></p>

      <form th:action="@{/ui/post/{id}/rate(id=${post.id})}" method="post"
            sec:authorize="isAuthenticated()" style="margin-top:1rem; padding:0; border:none; background:transparent; box-shadow:none;">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <label style="margin-top:0;">Rate this post (1–5)</label>
        <input type="number" name="rating" min="1" max="5" required style="max-width:80px;">
        <button type="submit">Rate</button>
      </form>
    </div>
  </main>
</html>
